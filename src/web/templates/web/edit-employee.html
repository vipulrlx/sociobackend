{% extends 'web/dashboard_layout.html' %}
{% load static %}

{% block title %}Edit Employee - SkillsNxt{% endblock %}
{% block page_title %}Edit Employee{% endblock %}
{% block breadcrumb %}Employee Management{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
    <!-- Success/Error Messages -->
    <div id="message" class="mb-3 hidden w-full">
      <div id="successMessage" class="bg-green-50 border border-green-200 text-green-700 px-3 py-2 rounded-lg hidden w-full">
        <div class="flex items-center w-full">
          <svg class="w-3 h-3 mr-2 flex-shrink-0 text-green-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <span id="successText" class="flex-1 text-sm"></span>
        </div>
      </div>
      <div id="errorMessage" class="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg hidden w-full">
        <div class="flex items-center w-full">
          <svg class="w-3 h-3 mr-2 flex-shrink-0 text-red-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
          </svg>
          <span id="errorText" class="flex-1 text-sm"></span>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="text-center py-6">
      <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-sm shadow rounded-md text-white bg-indigo-500 hover:bg-indigo-400 transition ease-in-out duration-150 cursor-not-allowed">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Loading employee data...
      </div>
    </div>

    <!-- Edit Form -->
    <form id="editEmployeeForm" class="hidden space-y-3">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <!-- Employee Name -->
        <div class="form-group">
          <label class="form-label" for="name">Employee Name *</label>
          <input 
            type="text" 
            id="name" 
            name="name" 
            required
            class="form-input"
            placeholder="Enter employee name"
          >
        </div>

        <div class="form-group">
          <label class="form-label" for="joining_date">Date of Birth *</label>
          <input 
            type="date" 
            id="birth_date" 
            name="birth_date" 
            required
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label class="form-label" for="designation">Gender *</label>
          <select 
            id="gender" 
            name="gender" 
            required
            class="form-input"
          >
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
        </div>

        <!-- Designation -->
        <div class="form-group">
          <label class="form-label" for="designation">Designation *</label>
          <select 
            id="designation" 
            name="designation" 
            required
            class="form-input"
          >
            <option value="">Select Designation</option>
            <option value="Employee">Employee</option>
            <option value="Trainer">Trainer</option>
          </select>
        </div>

        <!-- Department -->
        <div class="form-group">
          <label class="form-label" for="department">Department *</label>
          <select 
            id="department" 
            name="department" 
            required
            class="form-input"
          >
            <option value="">Select Department</option>
            <option value="Teaching">Teaching</option>
            <option value="Administration">Administration</option>
            <option value="Sales">Sales</option>
            <option value="Human Resources">Human Resources</option>
            <option value="Operations">Operations</option>
            <option value="Customer Support">Customer Support</option>
          </select>
        </div>

        <!-- Joining Date -->
        <div class="form-group">
          <label class="form-label" for="joining_date">Date of Joining *</label>
          <input 
            type="date" 
            id="joining_date" 
            name="joining_date" 
            required
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label class="form-label" for="joining_date">Contact Number *</label>
          <input 
            type="text" 
            id="contact_number" 
            name="contact_number" 
            required
            class="form-input"
            pattern="[0-9]{10}"
            title="(10 Digit Number)"
          >
        </div>

        <!-- User Email -->
        <div class="form-group">
          <label class="form-label" for="user_email">Email *</label>
          <input 
            type="email" 
            id="user_email" 
            name="user_email" 
            required
            class="form-input"
            placeholder="Enter email address"
            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
            title="Please enter a valid email address"
          >
          <div id="emailError" class="text-red-600 text-sm mt-1 hidden"></div>
        </div>


      </div>

      <!-- File Uploads -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <!-- Photo Upload -->
        <div class="form-group">
          <label class="form-label" for="photo">Employee Photo</label>
          <div class="mt-1 flex justify-center px-3 pt-3 pb-3 border-2 border-gray-300 border-dashed rounded-md">
            <div class="space-y-1 text-center">
              <div id="photoPreview" class="mb-2">
                <!-- Photo preview will be shown here -->
              </div>
              <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div class="flex text-sm text-gray-600">
                <label for="photo" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                  <span>Upload a photo</span>
                  <input id="photo" name="photo" type="file" class="sr-only" accept="image/*">
                </label>
                <p class="pl-1">or drag and drop</p>
              </div>
              <p class="text-xs text-gray-500">PNG, JPG, GIF up to 10MB</p>
            </div>
          </div>
        </div>

        <!-- Resume Upload -->
        <div class="form-group">
          <label class="form-label" for="resume">Educational Certificate</label>
          <div class="mt-1 flex justify-center px-3 pt-3 pb-3 border-2 border-gray-300 border-dashed rounded-md">
            <div class="space-y-1 text-center">
              <div id="resumePreview" class="mb-2">
                <!-- Resume preview will be shown here -->
              </div>
              <svg class="mx-auto h-8 w-8 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <div class="flex text-sm text-gray-600">
                <label for="resume" class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500">
                  <span>Upload a Certificate</span>
                  <input id="resume" name="resume" type="file" class="sr-only" accept=".pdf,.doc,.docx">
                </label>
                <p class="pl-1">or drag and drop</p>
              </div>
              <p class="text-xs text-gray-500">PDF, DOC, DOCX up to 10MB</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Submit Button and Messages -->
      <div class="pt-3 border-t border-gray-200">
        <!-- Success/Error Messages -->
        <div id="submitMessage" class="mb-3 hidden">
          <div id="submitSuccessMessage" class="bg-green-50 border border-green-200 text-green-700 px-3 py-2 rounded-lg hidden" style="background-color: #f0fdf4; border-color: #bbf7d0; color: #15803d;">
            <div class="flex items-center">
              <svg class="w-3 h-3 mr-2 flex-shrink-0 text-green-600" fill="currentColor" viewBox="0 0 20 20" style="width: 12px; height: 12px; color: #16a34a;">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
              </svg>
              <span id="submitSuccessText" class="flex-1 text-sm" style="font-size: 14px;"></span>
            </div>
          </div>
          <div id="submitErrorMessage" class="bg-red-50 border border-red-200 text-red-700 px-3 py-2 rounded-lg hidden" style="background-color: #fef2f2; border-color: #fecaca; color: #b91c1c;">
            <div class="flex items-center">
              <svg class="w-3 h-3 mr-2 flex-shrink-0 text-red-600" fill="currentColor" viewBox="0 0 20 20" style="width: 12px; height: 12px; color: #dc2626;">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
              </svg>
              <span id="submitErrorText" class="flex-1 text-sm" style="font-size: 14px;"></span>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end space-x-3 button-container">
          <button 
            type="button" 
            onclick="window.location.href='/employees/'"
            class="cancel-button"
          >
            Cancel
          </button>
          <button 
            type="submit" 
            id="submitBtn"
            class="submit-button"
          >
            <span id="submitText">Save Changes</span>
            <span id="submitSpinner" class="hidden">
              <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Saving...
            </span>
          </button>
        </div>
      </div>
    </form>

    <!-- Error State -->
    <div id="errorState" class="hidden text-center py-8">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z" />
      </svg>
      <h3 id="errorTitle" class="mt-2 text-sm font-medium text-gray-900">Employee not found</h3>
      <p id="errorMessage" class="mt-1 text-sm text-gray-500">The employee you're trying to edit doesn't exist or has been removed.</p>
      <div class="mt-4">
        <a href="/employees/" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Back to List
        </a>
      </div>
    </div>
  </div>
</div>

<style>
/* FIXED: Employee form page specific scrolling fixes */
.max-w-6xl.mx-auto {
  overflow-y: auto !important;
  height: auto !important;
  min-height: auto !important;
  max-height: none !important;
}

.bg-white.rounded-lg.shadow-sm.border.border-gray-200.p-4 {
  overflow-y: visible !important;
  height: auto !important;
  min-height: auto !important;
  max-height: none !important;
}

/* Form styling to match login/register theme */
.form-group {
  margin-bottom: 0.75rem;
}

.form-label {
  display: block;
  font-size: 0.875rem;
  font-weight: 500;
  color: #374151;
  margin-bottom: 0.25rem;
}

.form-input {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.875rem;
  transition: all 0.2s ease;
  background: white;
}

.form-input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.submit-button {
  padding: 0.625rem 1.5rem;
  background: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.submit-button:hover {
  background: #5a67d8;
  transform: translateY(-1px);
}

.submit-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.cancel-button {
  padding: 0.625rem 1.5rem;
  background: white;
  color: #374151;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.cancel-button:hover {
  background: #f9fafb;
  border-color: #9ca3af;
}

/* Message styling */
#message {
  margin-bottom: 0.75rem;
  width: 100%;
}

#successMessage, #errorMessage {
  padding: 0.5rem 0.75rem;
  border-radius: 6px;
  display: flex;
  align-items: center;
  width: 100%;
}

#successMessage {
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  color: #166534;
}

#errorMessage {
  background: #fef2f2;
  border: 1px solid #fecaca;
  color: #dc2626;
}

/* Icon styling */
#successMessage svg, #errorMessage svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

/* Text styling */
#successText, #errorText {
  flex: 1;
  word-wrap: break-word;
}

/* Button container styling */
.button-container {
  display: flex !important;
  justify-content: flex-end;
  align-items: center;
  gap: 0.75rem;
  margin-top: 0.75rem;
  visibility: visible !important;
  opacity: 1 !important;
  position: relative;
  z-index: 10;
}

/* Responsive adjustments */
@media (max-width: 1024px) {
  .grid {
    grid-template-columns: 1fr;
  }
  
  /* Only apply to form grid layouts, not button containers */
  .grid .flex.justify-end {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  /* Button container responsive behavior */
  .button-container {
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .submit-button, .cancel-button {
    width: 100%;
  }
}

/* FIXED: Override any conflicting height constraints */
body > div:first-child {
  overflow: visible !important;
}

.home_content {
  overflow: visible !important;
}

.main-content {
  overflow-y: auto !important;
  height: auto !important;
  min-height: auto !important;
  max-height: none !important;
}

/* Ensure form content can scroll */
#editEmployeeForm {
  overflow-y: visible !important;
  height: auto !important;
  min-height: auto !important;
  max-height: none !important;
}
</style>

<script>
let employee = null;
const employeeId = {{ employee_id|safe }};

// Load employee data on page load
document.addEventListener('DOMContentLoaded', function() {
    loadEmployeeData();
    setupFileUploads();
});

async function loadEmployeeData() {
    try {
        showLoading();
        
        // Check for authentication token
        const token = localStorage.getItem('access');
        if (!token) {
            window.location.href = '/login/';
            return;
        }
        
        const response = await fetch(`/api/v1/employee/${employeeId}/`, {
            method: 'GET',
            headers: {
                'Authorization': `Bearer ${token}`,
                'Content-Type': 'application/json'
            }
        });

        if (response.status === 403) {
            showPermissionError();
            return;
        }

        const data = await response.json();
        
        if (data.success) {
            employee = data.employee;
            populateForm();
        } else {
            showEmployeeNotFoundError();
        }
    } catch (error) {
        console.error('Error loading employee data:', error);
        showEmployeeNotFoundError();
    } finally {
        hideLoading();
    }
}

function populateForm() {
    if (!employee) {
        showEmployeeNotFoundError();
        return;
    }

    console.log('Employee data:', employee); // Debug log

    // Populate form fields
    document.getElementById('name').value = employee.name;
    document.getElementById('designation').value = employee.designation;
    document.getElementById('department').value = employee.department;
    document.getElementById('joining_date').value = employee.joining_date;
    document.getElementById('birth_date').value = employee.birth_date;
    document.getElementById('contact_number').value = employee.contact_number;
    document.getElementById('gender').value = employee.gender;
    
    // Populate readonly fields
    const emailField = document.getElementById('user_email');
    
    console.log('Email field:', emailField); // Debug log
    
    if (emailField) {
        emailField.value = employee.email || 'No email available';
        console.log('Setting email to:', employee.email || 'No email available'); // Debug log
    }

    // Show the form
    document.getElementById('editEmployeeForm').classList.remove('hidden');
    
    // Display existing photo if available
    if (employee.photo) {
        const photoPreview = document.getElementById('photoPreview');
        if (photoPreview) {
            photoPreview.innerHTML = `
                <img src="${employee.photo}" alt="Current Photo" class="w-12 h-12 rounded-full object-cover mx-auto">
            `;
        }
    }
    
    // Display existing resume if available
    if (employee.resume) {
        const resumePreview = document.getElementById('resumePreview');
        if (resumePreview) {
            resumePreview.innerHTML = `
                <div class="flex items-center justify-center p-2 rounded">
                    <svg class="w-8 h-8 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <span class="text-sm text-gray-600">Current Resume</span>
                </div>
            `;
        }
    }
}

function setupFileUploads() {
    // Photo upload preview
    document.getElementById('photo').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const photoPreview = document.getElementById('photoPreview');
                if (photoPreview) {
                    photoPreview.innerHTML = `
                        <img src="${e.target.result}" alt="Preview" class="w-12 h-12 rounded-full object-cover mx-auto">
                    `;
                }
            };
            reader.onerror = function() {
                console.error('Error reading file');
            };
            reader.readAsDataURL(file);
        }
    });

    // Resume upload preview
    document.getElementById('resume').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const resumePreview = document.getElementById('resumePreview');
            if (resumePreview) {
                resumePreview.innerHTML = `
                    <div class="flex items-center justify-center p-2 rounded">
                        <svg class="w-8 h-8 text-gray-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span class="text-sm text-gray-600">${file.name}</span>
                    </div>
                `;
            }
        }
    });
}

// Form submission
document.getElementById('editEmployeeForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Hide any previous messages
    hideMessages();
    
    try {
        setLoading(true);
        
        const formData = new FormData();
        formData.append('name', document.getElementById('name').value);
        formData.append('designation', document.getElementById('designation').value);
        formData.append('department', document.getElementById('department').value);
        formData.append('joining_date', document.getElementById('joining_date').value);
        formData.append('gender', document.getElementById('gender').value);
        formData.append('birth_date', document.getElementById('birth_date').value);
        formData.append('contact_number', document.getElementById('contact_number').value);
        
        // Add files if selected
        const photoFile = document.getElementById('photo').files[0];
        if (photoFile) {
            formData.append('photo', photoFile);
        }
        
        const resumeFile = document.getElementById('resume').files[0];
        if (resumeFile) {
            formData.append('resume', resumeFile);
        }

        // Check for authentication token
        const token = localStorage.getItem('access');
        if (!token) {
            window.location.href = '/login/';
            return;
        }
        
        const response = await fetch(`/api/v1/employee/${employeeId}/update/`, {
            method: 'PUT',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });

        if (response.status === 403) {
            showMessage('error', 'You don\'t have permission to update this employee.');
            return;
        }

        const data = await response.json();
        console.log('API Response:', data); // Debug log
        
        if (response.ok && data.success) {
            showMessage('success', data.message || 'Employee updated successfully!');
            setTimeout(() => {
                window.location.href = '/employees/';
            }, 2000);
        } else {
            showMessage('error', data.message || data.error || 'Failed to update employee');
        }
    } catch (error) {
        console.error('Error updating employee:', error);
        showMessage('error', 'Failed to update employee. Please try again.');
    } finally {
        setLoading(false);
    }
});

function showLoading() {
    document.getElementById('loadingState').classList.remove('hidden');
    document.getElementById('editEmployeeForm').classList.add('hidden');
    document.getElementById('errorState').classList.add('hidden');
}

function hideLoading() {
    document.getElementById('loadingState').classList.add('hidden');
}

function showError() {
    document.getElementById('errorState').classList.remove('hidden');
    document.getElementById('editEmployeeForm').classList.add('hidden');
}

function showEmployeeNotFoundError() {
    document.getElementById('errorTitle').textContent = 'Employee not found';
    document.getElementById('errorMessage').textContent = 'The employee you\'re trying to edit doesn\'t exist or has been removed.';
    document.getElementById('errorState').classList.remove('hidden');
    document.getElementById('editEmployeeForm').classList.add('hidden');
}

function showPermissionError() {
    document.getElementById('errorTitle').textContent = 'Access Denied';
    document.getElementById('errorMessage').textContent = 'You don\'t have permission to access this page. Please contact your administrator if you believe this is an error.';
    document.getElementById('errorState').classList.remove('hidden');
    document.getElementById('editEmployeeForm').classList.add('hidden');
}

function showSuccess(message) {
    console.log('showSuccess called with:', message); // Debug log
    
    const messageDiv = document.getElementById('message');
    const successDiv = document.getElementById('successMessage');
    const successText = document.getElementById('successText');
    
    console.log('Message elements:', { messageDiv, successDiv, successText }); // Debug log
    
    if (messageDiv && successDiv && successText) {
        successText.textContent = message;
        successDiv.classList.remove('hidden');
        messageDiv.classList.remove('hidden');
        
        console.log('Success message displayed'); // Debug log
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            messageDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
        }, 5000);
    } else {
        console.error('Message elements not found'); // Debug log
    }
}

function showError(message) {
    console.log('showError called with:', message); // Debug log
    
    const messageDiv = document.getElementById('message');
    const errorDiv = document.getElementById('errorMessage');
    const errorText = document.getElementById('errorText');
    
    console.log('Error elements:', { messageDiv, errorDiv, errorText }); // Debug log
    
    if (messageDiv && errorDiv && errorText) {
        errorText.textContent = message;
        errorDiv.classList.remove('hidden');
        messageDiv.classList.remove('hidden');
        
        console.log('Error message displayed'); // Debug log
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            messageDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
        }, 5000);
    } else {
        console.error('Error message elements not found'); // Debug log
    }
}

function showMessage(type, text) {
    console.log('showMessage called:', type, text); // Debug log
    
    const messageDiv = document.getElementById('submitMessage');
    const successDiv = document.getElementById('submitSuccessMessage');
    const errorDiv = document.getElementById('submitErrorMessage');
    const successText = document.getElementById('submitSuccessText');
    const errorText = document.getElementById('submitErrorText');
    
    console.log('Elements found:', { messageDiv, successDiv, errorDiv, successText, errorText }); // Debug log
    
    // Hide both messages first
    successDiv.classList.add('hidden');
    errorDiv.classList.add('hidden');
    messageDiv.classList.add('hidden');
    
    if (type === 'success') {
        console.log('Showing success message'); // Debug log
        successText.textContent = text;
        successDiv.classList.remove('hidden');
        messageDiv.classList.remove('hidden');
        
        console.log('Success div classes:', successDiv.className); // Debug log
        
        // Auto-hide success message after 5 seconds
        setTimeout(() => {
            messageDiv.classList.add('hidden');
            successDiv.classList.add('hidden');
        }, 5000);
    } else if (type === 'error') {
        console.log('Showing error message'); // Debug log
        errorText.textContent = text;
        errorDiv.classList.remove('hidden');
        messageDiv.classList.remove('hidden');
        
        console.log('Error div classes:', errorDiv.className); // Debug log
        
        // Auto-hide error message after 8 seconds
        setTimeout(() => {
            messageDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
        }, 8000);
    }
}

function hideMessages() {
    const messageDiv = document.getElementById('submitMessage');
    const successDiv = document.getElementById('submitSuccessMessage');
    const errorDiv = document.getElementById('submitErrorMessage');
    const successText = document.getElementById('submitSuccessText');
    const errorText = document.getElementById('submitErrorText');
    
    successText.textContent = '';
    errorText.textContent = '';
    
    // Hide both messages
    successDiv.classList.add('hidden');
    errorDiv.classList.add('hidden');
    messageDiv.classList.add('hidden');
}

function setLoading(loading) {
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const submitSpinner = document.getElementById('submitSpinner');
    
    if (loading) {
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitSpinner.classList.remove('hidden');
    } else {
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        submitSpinner.classList.add('hidden');
    }
}
</script>
{% endblock %} 